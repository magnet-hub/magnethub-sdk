<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MagnetHub Parent Example</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h2 {
      color: #333;
    }
    .controls {
      margin: 20px 0;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #45a049;
    }
    button.danger {
      background-color: #f44336;
    }
    button.danger:hover {
      background-color: #da190b;
    }
    #gameFrame {
      border: 2px solid #ddd;
      border-radius: 8px;
      background: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .log {
      margin-top: 20px;
      padding: 15px;
      background: #333;
      color: #0f0;
      font-family: 'Courier New', monospace;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 12px;
    }
    .log div {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h2>üß≤ MagnetHub Parent Page</h2>
  
  <div class="controls">
    <h3>Controls</h3>
    <button id="startGame">‚ñ∂Ô∏è Start Game</button>
    <button id="pauseGame">‚è∏Ô∏è Pause Game</button>
    <button id="resumeGame">‚ñ∂Ô∏è Resume Game</button>
    <button id="resetGame" class="danger">üîÑ Reset Game</button>
  </div>

  <iframe id="gameFrame" src="game.html" width="800" height="600"></iframe>

  <div class="log" id="log">
    <div>üì° Console Log:</div>
  </div>

  <script type="module">
    // Inline MagnetHub Core SDK for standalone example
    class MagnetHubCore {
      constructor({ iframeId, apiKey }) {
        this.iframe = document.getElementById(iframeId);
        this.apiKey = apiKey;
        this.events = {};

        if (!this.iframe) {
          console.warn(`MagnetHub: Iframe with id "${iframeId}" not found.`);
        }

        window.addEventListener('message', (e) => this._handleMessage(e));
      }

      send(event, data = null) {
        if (this.iframe && this.iframe.contentWindow) {
          this.iframe.contentWindow.postMessage(
            { event, data, source: 'magnethub-core' },
            '*'
          );
        } else {
          console.warn('MagnetHub: Cannot send message, iframe not available.');
        }
      }

      on(event, callback) {
        if (typeof callback !== 'function') {
          console.warn(`MagnetHub: Callback for event "${event}" must be a function.`);
          return;
        }
        this.events[event] = callback;
      }

      _handleMessage(e) {
        const { event, data, source } = e.data || {};
        
        if (source === 'magnethub-game' && event && this.events[event]) {
          this.events[event](data);
        }
      }
    }
    
    const log = document.getElementById('log');
    
    function addLog(message) {
      const entry = document.createElement('div');
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    // Initialize MagnetHub SDK
    const hub = new MagnetHubCore({ iframeId: 'gameFrame', apiKey: 'demo-api-key-xyz' });
    addLog('‚úÖ MagnetHub SDK initialized');

    // Listen for events from the game
    hub.on('gameLoaded', (data) => {
      addLog('üéÆ Game loaded successfully');
      console.log('Game loaded:', data);
    });

    hub.on('score', (data) => {
      addLog(`üéØ Score received: ${data.score}`);
      console.log('Score:', data);
    });

    hub.on('gameOver', (data) => {
      addLog(`üèÅ Game over! Final score: ${data.score}`);
      console.log('Game over:', data);
    });

    hub.on('gamePaused', () => {
      addLog('‚è∏Ô∏è Game paused');
    });

    hub.on('gameResumed', () => {
      addLog('‚ñ∂Ô∏è Game resumed');
    });

    // Control buttons
    document.getElementById('startGame').addEventListener('click', () => {
      hub.send('startGame', { level: 1 });
      addLog('üì§ Sent: startGame');
    });

    document.getElementById('pauseGame').addEventListener('click', () => {
      hub.send('pauseGame', { reason: 'User clicked pause' });
      addLog('üì§ Sent: pauseGame');
    });

    document.getElementById('resumeGame').addEventListener('click', () => {
      hub.send('resumeGame');
      addLog('üì§ Sent: resumeGame');
    });

    document.getElementById('resetGame').addEventListener('click', () => {
      hub.send('resetGame');
      addLog('üì§ Sent: resetGame');
    });

    // Auto-send start game after iframe loads
    setTimeout(() => {
      hub.send('startGame', { level: 1 });
      addLog('üì§ Auto-sent: startGame');
    }, 1000);
  </script>
</body>
</html>
